<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Merchants</title>
    <!-- bootstrap core css -->
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
    <!-- fonts style -->
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap"
      rel="stylesheet"
    />
    <!-- Custom styles for this template -->
    <link href="css/style.css" rel="stylesheet" />
    <!-- responsive style -->
    <link href="css/responsive.css" rel="stylesheet" />
    <!--import font-awesome-->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
    />
    <link rel="stylesheet" href="./css/merchants.css" />
    <script src="./js/chart.js"></script>
    <script src="./js/metamask-onboarding.bundle.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  </head>
  <body>
    <header class="header_section">
      <div class="container-fluid">
        <nav class="navbar navbar-expand-lg custom_nav-container">
          <a class="navbar-brand" href="index.html">
            <span>
              PolyCoin
              <img
                src="./images/logo.png"
                alt="logo"
                class="img-fluid logo_img"
              />
            </span>
          </a>
          <button
            class="navbar-toggler"
            type="button"
            data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <div
              class="d-flex ml-auto flex-column flex-lg-row align-items-center"
            >
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link" href="index.html">Home</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="about.html"> About </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="how.html"> How </a>
                </li>
                <li class="nav-item">
                  <a
                    class="nav-link"
                    href="metamask-integration-tutorial/index.html"
                  >
                    <span>Wallet</span> <img src="images/wallet.png" alt="" />
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#"> Login</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="#"> Sign Up</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="recyclers.html"
                    >Recyclers<span class="sr-only">(current)</span></a
                  >
                </li>
                <li class="nav-item active">
                  <a class="nav-link" href="recyclers.html">Merchants</a>
                </li>
              </ul>
              <div class="user_option">
                <form
                  class="form-inline my-2 my-lg-0 ml-0 ml-lg-4 mb-3 mb-lg-0"
                >
                  <button
                    class="btn my-2 my-sm-0 nav_search-btn"
                    type="submit"
                  ></button>
                </form>
              </div>
            </div>
          </div>
        </nav>
      </div>
    </header>
    <!--Side Menu-->
    <section id="sidebar">
      <!--Button to open the sidebar when the screen size is small-->
      <button class="sidebar_btn">
        <i class="fas fa-bars"></i>
      </button>
      <!--A div with the username and image-->
      <div class="user_info">
        <h4 class="user_name">Ruaka Bottlers</h4>
        <img src="./images/icons8-company-50.png" alt="user" class="user_img" />
      </div>
      <!--The menu items-->
      <div class="menu">
        <ul>
          <li>
            <img src="./images/icons8-conveyor-64.png" class="icon" />
            <span class="item" onclick="toggle('ordersMarket')"
              >Place Orders</span
            >
          </li>
          <li>
            <img src="./images/icons8-logistics-32.png" class="icon" />
            <span class="item" onclick="toggle('table')">My orders</span>
          </li>
          <li>
            <img src="./images/icons8-history-50.png" class="icon" />
            <span class="item" onclick="toggle('closedOrders')"
              >Order History</span
            >
          </li>
          <li>
            <img src="./images/icons8-payment-64.png" class="icon" />
            <span class="item">Payments</span>
          </li>
        </ul>
      </div>
    </section>

    <!--Main Content-->
    <section id="main_content">
      <h3>May 2024</h3>
      <div class="tiles">
        <div class="card materials">
          <img
            class="card-img-top"
            src="./images/icons8-plastic-bottle-64.png"
            alt="Card image cap"
          />
          <div class="card-body">
            <h5 class="card-title">Materials Ordered</h5>
            <p class="card-text">24 T</p>
          </div>
        </div>

        <div class="card orders">
          <img
            class="card-img-top"
            src="./images/icons8-logistics-64.png"
            alt="Card image cap"
          />
          <div class="card-body">
            <h5 class="card-title">Orders Made</h5>
            <p class="card-text">200</p>
          </div>
        </div>

        <div class="card fulfillment">
          <img
            class="card-img-top"
            src="./images/icons8-truck-100.png"
            alt="Card image cap"
          />
          <div class="card-body">
            <h5 class="card-title">Fulfillment Rate</h5>
            <p class="card-text">50 %</p>
          </div>
        </div>
      </div>

      <div class="graph" style="width: 1050px; height: 500px">
        <h1>Orders</h1>
        <canvas id="transactions"></canvas>
      </div>

      <div class="table">
        <h3>Orders</h3>
        <span class="close" onclick="toggle('table')">X</span>
        <br />
        <table class="table-bordered">
          <thead>
            <tr>
              <th scope="col">Order ID</th>
              <th scope="col">Date</th>
              <th scope="col">Weight Requested</th>
              <th scope="col">Innovator Address</th>
              <th scope="col">Estimated Tokens</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>May 1</td>
              <td>2 T</td>
              <td>0x1234567890</td>
              <td>0.32145</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!--Backdrop for the toggled Tabs-->
    <section class="backdrop"></section>

    <div class="closedOrders">
      <h3>History( Closed Orders )</h3>
      <span class="close" onclick="toggle('closedOrders')">X</span>
      <table class="table-bordered">
        <thead>
          <tr>
            <th scope="col">Order ID</th>
            <th scope="col">Date</th>
            <th scope="col">Materials Recycled</th>
            <th scope="col">InnovatorID</th>
            <th scope="col">Tokens Earned</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1</td>
            <td>May 1</td>
            <td>2 T</td>
            <td>0x1234567890</td>
            <td>0.32145</td>
          </tr>
        </tbody>
      </table>
    </div>
    <!--This is where the innovators see what orders have been placed and accept/deny them-->

    <div class="ordersMarket">
      <h3>Place an order for plastic</h3>
      <span class="close" onclick="toggle('ordersMarket')">X</span>
      <form id="placeOrderForm">
        <input
          type="number"
          placeholder="Enter the amount in (KG)"
          name="amountInKG"
          id="amountInKG"
        />
        <input type="submit" id="placeOrderButton" />
      </form>
      <p id="tokenEstimate"></p>
      <p style="display: none" id="placeOrderResponse">Response:</p>
    </div>
    <script>
      window.onload = function () {
        //Write the values dynamically
        dynamicWrite("fulfillment", 25, "%");
        dynamicWrite("orders", 200, " ");
        dynamicWrite("materials", 24, "T");
        dynamicWrite("tokens", 5.348, "PC");
        dynamicWrite("customer-yield", 80, "%");
        dynamicWrite("average-weight", 5, "T");
      };

      function toggle(className) {
        var table = document.getElementsByClassName(className)[0];
        if (table.style.display === "none" || table.style.display === "") {
          table.style.display = "block";
        } else {
          table.style.display = "none";
        }
        toggleBackdrop();
      }

      function dynamicWrite(className, targetValue, unit) {
        var element = document.getElementsByClassName(className)[0];
        var textHome = element.querySelector(".card-text");
        var currentValue = 0;

        var intervalId = setInterval(function () {
          if (currentValue <= targetValue) {
            textHome.innerHTML = currentValue + unit;
            currentValue++;
          } else {
            clearInterval(intervalId);
          }
        }, 50);
      }
      function toggleBackdrop() {
        var backdrop = document.getElementsByClassName("backdrop")[0];
        if (
          backdrop.style.display === "none" ||
          backdrop.style.display === ""
        ) {
          backdrop.style.display = "block";
        } else {
          backdrop.style.display = "none";
        }
      }
      function initGraph() {
        let graph = document.getElementsByClassName("graph")[0];
        graph.style.display = "block";
        graph.style.width = "100%";
        graph.style.height = "500px";

        let ctx = document.getElementById("transactions").getContext("2d");

        // Sample data
        let labels = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul"];
        let data = [0.0, 0.27, 0.33, 0.45, 0.19, 0.92, 0.94];

        let tokenChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Transation Value",
                data: data,
                backgroundColor: "rgba(255, 99, 132, 0.2)",
                borderColor: "rgba(255, 99, 132, 1)",
                tension: 0.1,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        });
      }
      initGraph();
    </script>
    <script src="./js/placeOrder.js"></script>
  </body>
</html>
